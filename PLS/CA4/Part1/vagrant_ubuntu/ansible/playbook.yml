---
- name: Provision VM
  hosts: all
  become: true
  # TASKS ARE run sequencial
  tasks:
    - name: Update the apt package index
      apt:
        update_cache: yes

    - name: Install Java
      apt:
        name: default-jre
        state: present

#- name: Enforce password policy
#  hosts: all
# become: true
#tasks:
#  - name: Apply password policy
#    ansible.builtin.import_role:
#     name: linux-system-roles.pam_pwd

- name: Create Groups and Users
  hosts: all
  become: true
  vars:
    linux_group: 'developers'
    linux_user: 'devuser'
  tasks:
    - name: Create groups
      group:
        name: '{{ linux_group }}'
        state: present
    - name: Create users
      user:
        name: '{{ linux_user }}'
        groups: '{{ linux_group }}'
        state: present

- name: Verify Web Status
  hosts: webservers
  become: true
  tasks:
    - name: Check if Web Server is running
      ansible.builtin.uri:
        url: 'http://localhost:8080'
        return_content: yes
        method: GET
      register: web_status

    - name: Display Web Server status
      debug:
        msg: 'Web Server status is {{ web_status.status }}'

- name: Verify Db Status
  hosts: dbservers
  become: true
  tasks:
    - wait_for:
        host: 192.168.250.11
        port: 9092
        timeout: 5 # seconds
    - debug: msg=ok
# Commands in Ansible to run this playbook:
# vagrant up
# vagrant ssh
# ansible
# ansible-playbook /vagrant/ansible/playbook.yml -i /vagrant/ansible/hosts -K

# Vagrant Uses the command:
# ansible-playbook â€“i hosts demo-playbook.yml
# to run the playbook from the /vagrant/ansible/ directory

# Verify syntax of the playbook before running:
# ansible-playbook --syntax-check demo-playbook.yml
