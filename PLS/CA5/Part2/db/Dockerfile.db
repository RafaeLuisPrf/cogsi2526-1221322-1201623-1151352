FROM ubuntu:22.04

RUN apt-get update && \
    apt-get install -y openjdk-17-jre-headless wget netcat iputils-ping && \
    wget https://repo1.maven.org/maven2/com/h2database/h2/2.2.224/h2-2.2.224.jar -O /h2.jar && \
    apt-get clean

RUN mkdir -p /h2

ENV H2_OPTIONS="-ifNotExists -tcp -tcpAllowOthers -tcpPort 9092"

EXPOSE 9092

HEALTHCHECK --interval=10s --timeout=3s --start-period=30s --retries=3 \
    CMD nc -z localhost 9092 || exit 1

CMD java -cp /h2.jar org.h2.tools.Server \
    -baseDir /h2 \
    $H2_OPTIONS
